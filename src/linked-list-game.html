<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¤ªç³–æŒ‘æˆ° - Linked List</title>
    <style>
        :root {
            --squid-pink: #ff1493;
            --squid-cyan: #00d9ff;
            --squid-dark: #0a0a0a;
            --squid-green: #00ff41;
            --dalgona-color: #f0e68c; /* æ¤ªç³–é¡è‰² */
            --dalgona-border: #d2b48c;
        }
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: var(--squid-dark);
            color: #fff;
            height: 100vh;
            overflow: hidden;
        }
        .playground-container {
            display: grid;
            grid-template-columns: 350px 1fr 350px;
            height: 100vh;
        }

        /* å…±ç”¨æ¨£å¼ */
        .sidebar, .tasks-panel {
            background: linear-gradient(135deg, #2d1a2d 0%, #1a0a1a 100%);
            border-right: 3px solid var(--squid-pink);
            overflow-y: auto;
            padding: 2rem 1rem;
        }
        .tasks-panel {
            border-right: none;
            border-left: 3px solid var(--squid-pink);
        }
        .tutorial-box, .status-box, .history-box {
            background: rgba(255, 20, 147, 0.1);
            border: 2px solid var(--squid-pink);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .tasks-panel h3, .tutorial-box h3 {
            color: var(--squid-pink);
            margin-bottom: 1rem;
        }
        .tutorial-box p {
            line-height: 1.8;
            color: #ddd;
        }
        .tutorial-box strong {
            color: var(--squid-cyan);
        }
        .back-button {
            position: absolute; top: 1rem; left: 1rem; background: rgba(255, 20, 147, 0.3);
            border: 2px solid var(--squid-pink); color: var(--squid-pink); width: 45px; height: 45px;
            border-radius: 50%; cursor: pointer; font-size: 1.3rem; text-decoration: none;
            display: flex; align-items: center; justify-content: center; z-index: 10; transition: all 0.3s;
        }
        .back-button:hover { background: var(--squid-pink); color: #000; }

        /* ä¸­é–“éŠæˆ²å€ */
        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            gap: 1.5rem;
        }
        .game-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, var(--squid-pink) 0%, #c71585 100%);
            color: #000;
            padding: 1rem 2rem;
            border-radius: 15px;
        }
        .game-header h1 { color: #000; text-shadow: none; }
        .game-info { display: flex; gap: 2rem; font-size: 1.5rem; }
        .game-info span { font-weight: bold; }

        /* æ¤ªç³–æŒ‘æˆ°éŠæˆ²å€ */
        .dalgona-container {
            position: relative;
            width: 400px;
            height: 400px;
        }
        .dalgona-svg {
            width: 100%;
            height: 100%;
        }
        .dalgona-cookie {
            fill: var(--dalgona-color);
            stroke: var(--dalgona-border);
            stroke-width: 5;
        }
        .node {
            fill: #fff;
            stroke: var(--squid-pink);
            stroke-width: 2;
            cursor: pointer;
            transition: r 0.2s, fill 0.2s;
        }
        .node.head {
            fill: var(--squid-green);
        }
        .node.active {
            fill: var(--squid-cyan);
            r: 12;
            animation: pulse 1s infinite;
        }
        .pointer {
            stroke: rgba(255, 255, 255, 0.2);
            stroke-width: 2;
            stroke-dasharray: 5 5;
        }
        .trace-line {
            stroke: var(--squid-green);
            stroke-width: 4;
            transition: all 0.3s;
        }
        .crack-line {
            stroke: red;
            stroke-width: 3;
            animation: crack 0.5s forwards;
        }
        @keyframes pulse { 50% { r: 15; } }
        @keyframes crack { from { stroke-dashoffset: 0; } to { stroke-dashoffset: 1000; } }

        #start-btn {
            background: var(--squid-pink); color: #000; border: none; padding: 1rem 2rem;
            font-size: 1.2rem; font-weight: bold; border-radius: 25px; cursor: pointer; transition: all 0.2s;
        }
        #start-btn:hover { background: var(--squid-cyan); box-shadow: 0 0 20px var(--squid-cyan); }
        #start-btn:disabled { background: #555; cursor: not-allowed; }

        /* å³å´ç‹€æ…‹ */
        .history-item {
            background: rgba(255, 20, 147, 0.1); padding: 0.75rem; border-radius: 8px;
            margin-bottom: 0.5rem; font-size: 0.9rem; border-left: 3px solid var(--squid-cyan);
        }
        .history-item.success { border-left-color: var(--squid-green); }
        .history-item.fail { border-left-color: #ff0000; }

        /* éé—œé é¢ */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7);
            display: flex; align-items: center; justify-content: center; z-index: 100; display: none;
        }
        .modal-content {
            background: var(--squid-dark); padding: 3rem; border-radius: 20px;
            border: 3px solid var(--squid-pink); text-align: center; box-shadow: 0 0 40px var(--squid-pink);
        }
        .modal-content h2 { font-size: 2.5rem; color: var(--squid-pink); margin-bottom: 1rem; }
        .modal-content p { font-size: 1.5rem; margin-bottom: 2rem; }
        .modal-content .final-score { color: var(--squid-cyan); font-weight: bold; font-size: 2rem; }
        .modal-buttons { display: flex; gap: 1rem; }
        .modal-buttons .btn {
            flex: 1; padding: 0.8rem 1.5rem; font-size: 1rem; text-decoration: none;
            display: inline-block; line-height: 1.5; border-radius: 12px; border: none; cursor: pointer;
        }
        .btn-replay { background: var(--squid-green); color: #000; }
        .btn-next { background: var(--squid-cyan); color: #000; }
    </style>
</head>
<body>
    <div class="playground-container">
        <!-- å·¦å´ï¼šæ•™å­¸ -->
        <div class="sidebar">
            <a href="index.html" class="back-button" title="è¿”å›ä¸»é¸å–®">ğŸ </a>
            <div class="tutorial-box" style="margin-top: 4rem;">
                <h3>ğŸ“– éŠæˆ²è¦å‰‡</h3>
                <p><strong>1. æ‰¾åˆ°èµ·é» (Head)</strong><br>ç¶ è‰²çš„ç¯€é»æ˜¯éˆçµä¸²åˆ—çš„èµ·é»ã€‚</p>
                <p><strong>2. ä¾åºé»æ“Šç¯€é»</strong><br>æˆåŠŸé»æ“Šå¾Œï¼Œä¸‹ä¸€å€‹ç¯€é»æœƒäº®èµ·ï¼Œè«‹è·Ÿéš¨æŒ‡å¼•å®Œæˆåœ–æ¡ˆã€‚</p>
                <p><strong>3. é»éŒ¯å°±å¤±æ•—ï¼</strong><br>å¦‚æœé»åˆ°éŒ¯èª¤çš„ç¯€é»ï¼Œæ¤ªç³–å°±æœƒç¢è£‚ï¼ŒéŠæˆ²ç›´æ¥å¤±æ•—ï¼</p>
            </div>
            <div class="tutorial-box">
                <h3>ğŸ’¡ å­¸ç¿’é‡é»: Linked List</h3>
                <p><strong>â€¢ ç¯€é» (Node)</strong><br>æ¯å€‹é»éƒ½æ˜¯ä¸€å€‹ç¯€é»ï¼Œå®ƒå„²å­˜äº†è‡ªå·±çš„ä½ç½®ã€‚</p>
                <p><strong>â€¢ æŒ‡æ¨™ (Pointer)</strong><br>æ¯å€‹ç¯€é»å…§éƒ¨éƒ½æœ‰ä¸€å€‹ã€ŒæŒ‡æ¨™ã€ï¼ŒæŒ‡å‘ä¸‹ä¸€å€‹ç¯€é»çš„ä½ç½®ã€‚éŠæˆ²ä¸­çš„è™›ç·šå°±æ˜¯æŒ‡æ¨™çš„è¦–è¦ºåŒ–ã€‚</p>
                <p><strong>â€¢ éæ­· (Traversal)</strong><br>è·Ÿéš¨æŒ‡æ¨™å¾ä¸€å€‹ç¯€é»ç§»å‹•åˆ°ä¸‹ä¸€å€‹ç¯€é»çš„éç¨‹ï¼Œå°±ç¨±ç‚ºéæ­·ã€‚ä½ çš„ä»»å‹™å°±æ˜¯å®Œæˆæ•´å€‹éˆçµä¸²åˆ—çš„éæ­·ï¼</p>
            </div>
        </div>

        <!-- ä¸­é–“ï¼šéŠæˆ²å€ -->
        <div class="game-area">
            <div class="game-header">
                <h1>ğŸª æ¤ªç³–æŒ‘æˆ°</h1>
                <div class="game-info">
                    <div>åˆ†æ•¸: <span id="score">0</span></div>
                    <div>æ™‚é–“: <span id="timer">45</span>s</div>
                </div>
            </div>
            <div class="dalgona-container">
                <svg id="dalgona-svg" class="dalgona-svg"></svg>
            </div>
            <button id="start-btn" class="btn">é–‹å§‹æŒ‘æˆ°</button>
        </div>

        <!-- å³å´ï¼šç‹€æ…‹ -->
        <div class="tasks-panel">
            <div class="status-box">
                <h3>ğŸ“Š éŠæˆ²ç‹€æ…‹</h3>
                <div id="game-status"><p>éŠæˆ²å°šæœªé–‹å§‹</p></div>
            </div>
            <div class="history-box">
                <h3>ğŸ“‹ æ“ä½œè¨˜éŒ„</h3>
                <div id="history"><p style="color: #666; text-align: center;">é‚„æ²’æœ‰è¨˜éŒ„</p></div>
            </div>
        </div>
    </div>

    <!-- éé—œé é¢ -->
    <div class="modal-overlay" id="end-game-modal">
        <div class="modal-content">
            <h2 id="modal-title">æŒ‘æˆ°å¤±æ•—</h2>
            <p>ä½ çš„æœ€çµ‚åˆ†æ•¸æ˜¯: <span class="final-score" id="final-score">0</span></p>
            <div class="modal-buttons">
                <button class="btn btn-replay" id="replay-btn">é‡æ–°æŒ‘æˆ°</button>
                <a href="stack-game.html" class="btn btn-next" id="next-level-btn">å‰å¾€ä¸‹ä¸€é—œ</a>
            </div>
        </div>
    </div>

    <script>
        const svg = document.getElementById('dalgona-svg');
        const startBtn = document.getElementById('start-btn');
        const scoreBoard = document.getElementById('score');
        const timerBoard = document.getElementById('timer');
        const gameStatus = document.getElementById('game-status');
        const historyLog = document.getElementById('history');
        const endGameModal = document.getElementById('end-game-modal');
        const modalTitle = document.getElementById('modal-title');
        const finalScoreDisplay = document.getElementById('final-score');
        const replayBtn = document.getElementById('replay-btn');
        const nextLevelBtn = document.getElementById('next-level-btn');

        let gameTime = 45; // é è¨­æ™‚é–“
        let score = 0, timerInterval = null, isPlaying = false, currentNodeIndex = 0;
        const nodes = [ // T å­—å½¢
            { x: 120, y: 100 }, { x: 200, y: 100 }, { x: 280, y: 100 }, { x: 200, y: 180 }, { x: 200, y: 260 }
        ];

        function addHistory(message, type) {
            if (historyLog.querySelector('p')) historyLog.innerHTML = '';
            const item = document.createElement('div');
            item.className = `history-item ${type}`;
            item.textContent = message;
            historyLog.insertBefore(item, historyLog.firstChild);
            if (historyLog.children.length > 10) historyLog.removeChild(historyLog.lastChild);
        }

        function renderGame() {
            svg.innerHTML = ''; // æ¸…ç©ºç•«å¸ƒ
            // ç•«æ¤ªç³–èƒŒæ™¯
            const cookie = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            cookie.setAttribute('cx', '200'); cookie.setAttribute('cy', '200');
            cookie.setAttribute('r', '150'); cookie.setAttribute('class', 'dalgona-cookie');
            svg.appendChild(cookie);

            // ç•«æŒ‡æ¨™ (è™›ç·š)
            for (let i = 0; i < nodes.length; i++) {
                const nextNode = nodes[(i + 1) % nodes.length];
                const pointer = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                pointer.setAttribute('x1', String(nodes[i].x)); pointer.setAttribute('y1', String(nodes[i].y));
                pointer.setAttribute('x2', String(nextNode.x)); pointer.setAttribute('y2', String(nextNode.y));
                pointer.setAttribute('class', 'pointer');
                svg.appendChild(pointer);
            }

            // ç•«ç¯€é»
            nodes.forEach((node, index) => {
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', String(node.x)); circle.setAttribute('cy', String(node.y));
                circle.setAttribute('r', '10');
                circle.setAttribute('class', 'node');
                circle.dataset.index = String(index);
                if (index === 0) circle.classList.add('head');
                circle.addEventListener('click', handleNodeClick);
                svg.appendChild(circle);
            });
        }

        function handleNodeClick(e) {
            if (!isPlaying) return;
            const clickedIndex = parseInt(e.target.dataset.index);

            if (clickedIndex === currentNodeIndex) {
                // é»æ“Šæ­£ç¢º
                score += 100;
                addHistory(`é»æ“Šç¯€é» #${clickedIndex} æ­£ç¢ºï¼`, 'success');

                // ç•«å‡ºè»Œè·¡
                if (currentNodeIndex > 0) {
                    const prevNode = nodes[currentNodeIndex - 1];
                    const trace = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    trace.setAttribute('x1', String(prevNode.x)); trace.setAttribute('y1', String(prevNode.y));
                    trace.setAttribute('x2', String(nodes[clickedIndex].x)); trace.setAttribute('y2', String(nodes[clickedIndex].y));
                    trace.setAttribute('class', 'trace-line');
                    svg.insertBefore(trace, svg.querySelector('.node'));
                }
                
                currentNodeIndex++;
                updateActiveNode(); // æ›´æ–°ä¸‹ä¸€å€‹æ´»å‹•ç¯€é»

                if (currentNodeIndex === nodes.length) {
                    // å®Œæˆæœ€å¾Œä¸€å€‹ç¯€é»ï¼Œè£œä¸Šæœ€å¾Œä¸€æ¢ç·š
                    const lastTrace = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    lastTrace.setAttribute('x1', String(nodes[nodes.length - 1].x)); lastTrace.setAttribute('y1', String(nodes[nodes.length - 1].y));
                    lastTrace.setAttribute('x2', String(nodes[0].x)); lastTrace.setAttribute('y2', String(nodes[0].y));
                    lastTrace.setAttribute('class', 'trace-line');
                    svg.insertBefore(lastTrace, svg.querySelector('.node'));
                    endGame(true); // ç²å‹
                }
            } else {
                // é»æ“ŠéŒ¯èª¤
                addHistory(`é»æ“ŠéŒ¯èª¤ï¼æ¤ªç³–ç¢äº†ï¼`, 'fail');
                const correctNode = nodes[currentNodeIndex];
                const crack = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                crack.setAttribute('x1', String(Math.random() * 400)); crack.setAttribute('y1', String(Math.random() * 400));
                crack.setAttribute('x2', String(correctNode.x)); crack.setAttribute('y2', String(correctNode.y));
                crack.setAttribute('class', 'crack-line');
                svg.appendChild(crack);
                endGame(false); // å¤±æ•—
            }
            scoreBoard.textContent = String(score);
        }

        function updateActiveNode() {
            document.querySelectorAll('.node').forEach(n => n.classList.remove('active'));
            const activeNode = document.querySelector(`.node[data-index='${currentNodeIndex}']`);
            if (activeNode) activeNode.classList.add('active');
        }

        function startGame() {
            endGameModal.style.display = 'none';
            isPlaying = true;
            score = 0;
            currentNodeIndex = 0;
            let timeLeft = gameTime;

            scoreBoard.textContent = String(score);
            timerBoard.textContent = String(timeLeft);
            startBtn.style.display = 'none';
            gameStatus.innerHTML = '<p style="color: var(--squid-green);">éŠæˆ²é€²è¡Œä¸­...</p>';
            historyLog.innerHTML = '';
            
            renderGame();
            // éŠæˆ²é–‹å§‹æ™‚ï¼Œåªé¡¯ç¤ºç¶ è‰²é ­ç¯€é»ï¼Œä¸ç«‹å³æ¿€æ´»
            const headNode = document.querySelector(`.node[data-index='0']`);
            if(headNode) headNode.classList.add('head');

            addHistory('æŒ‘æˆ°é–‹å§‹ï¼è«‹é»æ“Šç¶ è‰²ç¯€é»ã€‚', 'info');

            timerInterval = setInterval(() => {
                timeLeft--;
                timerBoard.textContent = String(timeLeft);
                if (timeLeft <= 0) {
                    addHistory('æ™‚é–“åˆ°ï¼æŒ‘æˆ°å¤±æ•—ï¼', 'fail');
                    endGame(false);
                }
            }, 1000);
        }

        function endGame(isWin) {
            isPlaying = false;
            clearInterval(timerInterval);
            startBtn.style.display = 'block';

            if (isWin) {
                modalTitle.textContent = 'æŒ‘æˆ°æˆåŠŸï¼';
                finalScoreDisplay.textContent = String(score + parseInt(timerBoard.textContent) * 50); // æ™‚é–“çå‹µ
                nextLevelBtn.style.display = 'inline-block';
                gameStatus.innerHTML = `<p style="color: var(--squid-green);">æŒ‘æˆ°æˆåŠŸï¼</p>`;
            } else {
                modalTitle.textContent = 'æŒ‘æˆ°å¤±æ•—ï¼';
                finalScoreDisplay.textContent = String(score);
                nextLevelBtn.style.display = 'none';
                gameStatus.innerHTML = `<p style="color: #ff0000;">æŒ‘æˆ°å¤±æ•—ï¼</p>`;
            }
            endGameModal.style.display = 'flex';
        }

        startBtn.addEventListener('click', startGame);
        replayBtn.addEventListener('click', startGame);
        renderGame(); // åˆå§‹é¡¯ç¤ºåœ–æ¡ˆ
    </script>
</body>
</html>