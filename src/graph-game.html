<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€çŸ­è·¯å¾‘æŒ‘æˆ° - Graph</title>
    <style>
        :root {
            --squid-pink: #ff1493;
            --squid-cyan: #00d9ff;
            --squid-dark: #0a0a0a;
            --squid-green: #00ff41;
        }
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: var(--squid-dark);
            color: #fff;
            height: 100vh;
            overflow: hidden;
        }
        .playground-container {
            display: grid;
            grid-template-columns: 350px 1fr 350px;
            height: 100vh;
        }

        /* å…±ç”¨æ¨£å¼ */
        .sidebar, .tasks-panel {
            background: linear-gradient(135deg, #2d1a2d 0%, #1a0a1a 100%);
            border-right: 3px solid var(--squid-pink);
            overflow-y: auto;
            padding: 2rem 1rem;
        }
        .tasks-panel {
            border-right: none;
            border-left: 3px solid var(--squid-pink);
        }
        .tutorial-box, .status-box, .history-box {
            background: rgba(255, 20, 147, 0.1);
            border: 2px solid var(--squid-pink);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .tasks-panel h3, .tutorial-box h3 {
            color: var(--squid-pink);
            margin-bottom: 1rem;
        }
        .tutorial-box p { line-height: 1.8; color: #ddd; }
        .tutorial-box strong { color: var(--squid-cyan); }
        .back-button {
            position: absolute; top: 1rem; left: 1rem; background: rgba(255, 20, 147, 0.3);
            border: 2px solid var(--squid-pink); color: var(--squid-pink); width: 45px; height: 45px;
            border-radius: 50%; cursor: pointer; font-size: 1.3rem; text-decoration: none;
            display: flex; align-items: center; justify-content: center; z-index: 10; transition: all 0.3s;
        }
        .back-button:hover { background: var(--squid-pink); color: #000; }

        /* ä¸­é–“éŠæˆ²å€ */
        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        .game-header { text-align: center; margin-bottom: 1rem; }
        .game-header h1 { color: var(--squid-cyan); font-size: 2.5rem; }
        .game-header p { color: #aaa; font-size: 1.2rem; }
        
        .graph-container {
            width: 100%;
            height: 70vh;
            position: relative;
        }
        .graph-svg { width: 100%; height: 100%; }
        .graph-edge { stroke: rgba(255, 255, 255, 0.3); stroke-width: 2; transition: stroke 0.3s; }
        .graph-edge.path { stroke: var(--squid-green); stroke-width: 4; }
        .edge-weight { fill: #fff; font-size: 14px; font-weight: bold; pointer-events: none; }
        .graph-node {
            fill: #555; /* æœªè¨ªå•ç¯€é»é¡è‰² */
            stroke: #000;
            stroke-width: 2;
            cursor: pointer;
            transition: fill 0.2s;
        }
        .graph-node.start { fill: var(--squid-green); }
        .graph-node.end { fill: var(--squid-pink); }
        .graph-node.visited {
            fill: var(--squid-green);
            cursor: default;
        }
        .graph-node.option {
            fill: var(--squid-cyan);
            box-shadow: 0 0 20px var(--squid-cyan);
        }
        .graph-node.option:hover {
            fill: #00f0ff;
        }
        .node-label {
            fill: var(--squid-pink);
            font-size: 16px;
            font-weight: bold;
            text-anchor: middle;
            pointer-events: none;
        }
        .node-icon {
            font-size: 20px; /* èª¿æ•´é­·é­šåœ–ç¤ºå¤§å° */
            text-anchor: middle;
            dominant-baseline: central;
            pointer-events: none;
        }
        #start-btn {
            background: var(--squid-pink); color: #000; border: none; padding: 1rem 2rem;
            font-size: 1.2rem; font-weight: bold; border-radius: 25px; cursor: pointer; transition: all 0.2s;
            margin-top: 1rem;
        }

        /* å³å´ç‹€æ…‹ */
        .history-item {
            background: rgba(255, 20, 147, 0.1); padding: 0.75rem; border-radius: 8px;
            margin-bottom: 0.5rem; font-size: 0.9rem; border-left: 3px solid var(--squid-cyan);
        }
        .history-item.success { border-left-color: var(--squid-green); }
        .history-item.fail { border-left-color: #ff0000; }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        .modal-content {
            background: var(--squid-dark); padding: 3rem; border-radius: 20px;
            text-align: center; border: 3px solid var(--squid-pink); box-shadow: 0 0 40px var(--squid-pink);
        }
        .modal-content h2 { font-size: 2.5rem; color: var(--squid-pink); margin-bottom: 1rem; }
        .modal-content p { font-size: 1.5rem; margin-bottom: 2rem; }
        .modal-buttons { display: flex; gap: 1rem; }
        .modal-buttons .btn {
            flex: 1; padding: 0.8rem 1.5rem; font-size: 1rem; text-decoration: none;
            display: inline-block; line-height: 1.5; border: none; cursor: pointer; border-radius: 12px;
        }
        .btn-replay { background: var(--squid-green); color: #000; }
        .btn-next { background: var(--squid-cyan); color: #000; }
    </style>
</head>
<body>
    <div class="playground-container">
        <!-- å·¦å´ï¼šæ•™å­¸ -->
        <div class="sidebar">
            <a href="index.html" class="back-button" title="è¿”å›ä¸»é¸å–®">ğŸ </a>
            <div class="tutorial-box" style="margin-top: 4rem;">
                <h3>ğŸ“– éŠæˆ²è¦å‰‡</h3>
                <p><strong>1. é–‹å§‹æŒ‘æˆ°</strong><br>é»æ“Šä¸‹æ–¹çš„<strong>ã€Œé–‹å§‹æŒ‘æˆ°ã€</strong>æŒ‰éˆ•ï¼Œå•Ÿå‹•æ¼”ç®—æ³•ã€‚</p>
                <p><strong>2. è·Ÿéš¨æŒ‡å¼•</strong><br>å¾ç¶ è‰²çš„<strong>èµ·é»</strong>é–‹å§‹ï¼Œé»æ“Šå”¯ä¸€äº®è—è‰²çš„ç¯€é»ã€‚</p>
                <p><strong>3. æŠµé”çµ‚é»</strong><br>è·Ÿéš¨æŒ‡å¼•ä¸€è·¯é»æ“Šï¼Œç›´åˆ°æŠµé”æ¨™æœ‰ã€Œçµ‚é»ã€çš„ç²‰ç´…è‰²ç¯€é»ï¼Œå³å¯éé—œï¼</p>
            </div>
            <div class="tutorial-box">
                <h3>ğŸ’¡ å­¸ç¿’é‡é»</h3>
                <p><strong>ç•«é¢å…ƒç´ ï¼š</strong></p>
                <p><strong>ç¯€é» (åœ“åœˆ)</strong>: ä»£è¡¨åœ–ä¸­çš„åœ°é»æˆ–ç‹€æ…‹ã€‚</p>
                <p><strong>é‚Š (é€£ç·š)</strong>: é€£æ¥å…©å€‹ç¯€é»ï¼Œè¡¨ç¤ºå®ƒå€‘ä¹‹é–“æœ‰è·¯å¾‘ã€‚</p>
                <p><strong>æ¬Šé‡ (æ•¸å­—)</strong>: é‚Šä¸Šçš„æ•¸å­—ï¼Œä»£è¡¨å¾ä¸€å€‹ç¯€é»åˆ°å¦ä¸€å€‹ç¯€é»çš„æˆæœ¬æˆ–è·é›¢ã€‚</p>
                <hr style="border-color: rgba(255, 20, 147, 0.2); margin: 1rem 0;">
                <p><strong>Dijkstra æ¼”ç®—æ³•ï¼š</strong></p>
                <p>é€™å€‹éŠæˆ²ä¸¦ä¸æ˜¯è®“æ‚¨æ‰‹å‹•è¨ˆç®—æœ€çŸ­è·¯å¾‘ï¼Œè€Œæ˜¯è®“æ‚¨<strong>é«”é©—æ¼”ç®—æ³•çš„ã€Œçµæœã€</strong>ã€‚</p>
                <p><strong>æ‚¨æ‰€çœ‹åˆ°çš„ï¼š</strong><br>
                ç•¶æ‚¨é»æ“Šé–‹å§‹å¾Œï¼ŒéŠæˆ²æœƒæŒ‡å¼•æ‚¨èµ°ä¸€æ¢ç‰¹å®šçš„è·¯å¾‘ã€‚é€™æ¢è·¯å¾‘ï¼Œå°±æ˜¯ <strong>Dijkstra æ¼”ç®—æ³•</strong> å·²ç¶“åœ¨èƒŒå¾Œè¨ˆç®—å‡ºçš„ã€å¾èµ·é»åˆ°çµ‚é»çš„<strong>å”¯ä¸€æœ€çŸ­è·¯å¾‘</strong>ã€‚</p>
                <p><strong>æ¼”ç®—æ³•åœ¨åšä»€éº¼ï¼š</strong><br>
                æ¼”ç®—æ³•æœƒå¾èµ·é»é–‹å§‹ï¼Œæ¢ç´¢æ‰€æœ‰å¯èƒ½çš„è·¯å¾‘ï¼Œæ¯”è¼ƒå®ƒå€‘çš„ç¸½æ¬Šé‡ï¼ˆæˆæœ¬ï¼‰ï¼Œä¸¦é€æ­¥æ‰¾å‡ºæˆæœ¬æœ€ä½çš„èµ°æ³•ã€‚</p>
                <p><strong>å¦‚ä½•å­¸ç¿’ï¼š</strong><br>
                è·Ÿéš¨äº®è—è‰²ç¯€é»çš„æŒ‡å¼•ï¼Œæ‚¨å°±æ˜¯åœ¨è¦–è¦ºåŒ–åœ°èµ°éä¸€éæ¼”ç®—æ³•æ‰¾åˆ°çš„æœ€ä½³è·¯ç·šã€‚æ‚¨å¯ä»¥è§€å¯Ÿé€™æ¢è·¯å¾‘ï¼Œæ€è€ƒç‚ºä»€éº¼æ¼”ç®—æ³•æœƒé€™æ¨£é¸æ“‡ï¼Œå¾è€Œç›´è§€åœ°ç†è§£ã€Œæœ€çŸ­è·¯å¾‘ã€çš„æ„ç¾©ã€‚</p>
            </div>
        </div>

        <!-- ä¸­é–“ï¼šéŠæˆ²å€ -->
        <div class="game-area">
            <div class="game-header">
                <h1>æœ€çŸ­è·¯å¾‘æŒ‘æˆ°</h1>
                <p>è·Ÿéš¨ Dijkstra æ¼”ç®—æ³•ï¼Œæ‰¾å‡ºæœ€çŸ­è·¯å¾‘</p>
            </div>
            <div id="graph-container" class="graph-container">
                <svg id="graph-svg" class="graph-svg"></svg>
            </div>
            <button id="start-btn" class="btn">é–‹å§‹æŒ‘æˆ°</button>
        </div>

        <!-- å³å´ï¼šç‹€æ…‹ -->
        <div class="tasks-panel">
            <div class="status-box">
                <h3>ğŸ“Š éŠæˆ²ç‹€æ…‹</h3>
                <div id="game-status"><p>é»æ“Šã€Œé–‹å§‹æŒ‘æˆ°ã€</p></div>
            </div>
            <div class="history-box">
                <h3>ğŸ“‹ æ“ä½œè¨˜éŒ„</h3>
                <div id="history"><p style="color: #666; text-align: center;">é‚„æ²’æœ‰è¨˜éŒ„</p></div>
            </div>
        </div>
    </div>
    
    <!-- éé—œé é¢ -->
    <div class="modal-overlay" id="end-game-modal">
        <div class="modal-content">
            <h2 id="modal-title">æŒ‘æˆ°å¤±æ•—</h2>
            <p>ä½ æˆåŠŸéµå¾ªäº†æ¼”ç®—æ³•çš„æŒ‡å¼•ï¼</p>
            <div class="modal-buttons">
                <button class="btn btn-replay" id="replay-btn">é‡æ–°æŒ‘æˆ°</button>
                <a href="sorting-game.html" class="btn btn-next" id="next-level-btn">å‰å¾€ä¸‹ä¸€é—œ</a>
            </div>
        </div>
    </div>

    <script>
        // Game Setup
        const nodesData = [
            { id: 0, x: 100, y: 300 }, { id: 1, x: 250, y: 100 }, { id: 2, x: 250, y: 500 },
            { id: 3, x: 450, y: 100 }, { id: 4, x: 450, y: 500 }, { id: 5, x: 600, y: 300 }
        ];
        const edgesData = [
            { from: 0, to: 1, weight: 7 }, { from: 0, to: 2, weight: 9 }, { from: 0, to: 5, weight: 14 },
            { from: 1, to: 3, weight: 10 }, { from: 1, to: 2, weight: 15 },
            { from: 2, to: 4, weight: 11 }, { from: 2, to: 5, weight: 2 },
            { from: 3, to: 4, weight: 6 }, { from: 3, to: 5, weight: 9 },
            { from: 4, to: 5, weight: 13 }
        ];
        const START_NODE = 0;
        const END_NODE = 5;

        // DOM Elements
        const svg = document.getElementById('graph-svg');
        const startBtn = document.getElementById('start-btn');
        const gameStatus = document.getElementById('game-status');
        const historyLog = document.getElementById('history');
        const endGameModal = document.getElementById('end-game-modal');
        const modalTitle = document.getElementById('modal-title');
        const replayBtn = document.getElementById('replay-btn');
        const nextLevelBtn = document.getElementById('next-level-btn');

        // Game State
        let isPlaying = false;
        let shortestPath = [];
        let currentPlayerStep = 0;

        // --- Dijkstra's Algorithm to find the path ---
        function dijkstra(nodes, edges, startNodeId, endNodeId) {
            const dist = {};
            const prev = {};
            const pq = new Set();

            nodes.forEach(node => {
                dist[node.id] = Infinity;
                prev[node.id] = null;
                pq.add(node.id);
            });

            dist[startNodeId] = 0;

            while (pq.size > 0) {
                let u = null;
                let minDistance = Infinity;
                for (const nodeId of pq) {
                    if (dist[nodeId] < minDistance) {
                        minDistance = dist[nodeId];
                        u = nodeId;
                    }
                }
                
                if (u === null || u === endNodeId) break;
                pq.delete(u);

                const neighbors = edges.filter(e => e.from === u || e.to === u);
                for (const edge of neighbors) {
                    const v = edge.from === u ? edge.to : edge.from;
                    if (pq.has(v)) {
                        const alt = dist[u] + edge.weight;
                        if (alt < dist[v]) {
                            dist[v] = alt;
                            prev[v] = u;
                        }
                    }
                }
            }
            
            const path = [];
            let current = endNodeId;
            while(current !== null) {
                path.unshift(current);
                current = prev[current];
            }
            return path;
        }

        // --- UI & Game Logic ---
        function addHistory(message, type) {
            if (historyLog.querySelector('p')) {
                historyLog.innerHTML = '';
            }
            const item = document.createElement('div');
            item.className = `history-item ${type}`;
            item.textContent = message;
            historyLog.prepend(item);
        }

        function renderGraph() {
            svg.innerHTML = '';
            edgesData.forEach(edge => {
                const fromNode = nodesData.find(n => n.id === edge.from);
                const toNode = nodesData.find(n => n.id === edge.to);
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', String(fromNode.x)); line.setAttribute('y1', String(fromNode.y));
                line.setAttribute('x2', String(toNode.x)); line.setAttribute('y2', String(toNode.y));
                line.setAttribute('class', 'graph-edge');
                line.id = `edge-${edge.from}-${edge.to}`;
                svg.appendChild(line);

                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', String((fromNode.x + toNode.x) / 2 + 5));
                text.setAttribute('y', String((fromNode.y + toNode.y) / 2 - 5));
                text.setAttribute('class', 'edge-weight');
                text.textContent = String(edge.weight);
                svg.appendChild(text);
            });

            nodesData.forEach(node => {
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                g.setAttribute('class', 'graph-node-group');
                g.dataset.id = String(node.id);
                g.addEventListener('click', handleNodeClick);

                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', String(node.x)); circle.setAttribute('cy', String(node.y));
                circle.setAttribute('r', '15');
                circle.setAttribute('class', 'graph-node');
                if (node.id === START_NODE) circle.classList.add('start');
                if (node.id === END_NODE) circle.classList.add('end');
                g.appendChild(circle);

                if (node.id === END_NODE) {
                    const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    label.setAttribute('x', String(node.x));
                    label.setAttribute('y', String(node.y - 25));
                    label.setAttribute('class', 'node-label');
                    label.textContent = 'çµ‚é»';
                    g.appendChild(label);
                }
                
                svg.appendChild(g);
            });
        }

        function handleNodeClick(e) {
            const groupElement = e.target.closest('.graph-node-group');
            if (!groupElement || !isPlaying) return;
            
            const clickedId = parseInt(groupElement.dataset.id);
            const correctNextNodeId = shortestPath[currentPlayerStep + 1];

            if (clickedId === correctNextNodeId) {
                addHistory(`æ­£ç¢ºï¼ç§»å‹•åˆ°ç¯€é» #${clickedId}`, 'success');
                currentPlayerStep++;
                updateGraphUI();
                if (clickedId === END_NODE) {
                    endGame(true);
                }
            } else if (clickedId !== shortestPath[currentPlayerStep]) {
                addHistory('éŒ¯èª¤ï¼è«‹è·Ÿéš¨é­·é­šçš„æŒ‡å¼•ã€‚', 'fail');
            }
        }
        
        function updateGraphUI() {
            document.querySelectorAll('.graph-node-group').forEach(g => {
                const circle = g.querySelector('.graph-node');
                const existingIcon = g.querySelector('.node-icon');
                if (existingIcon) existingIcon.remove();

                circle.classList.remove('visited', 'option');
                
                const id = parseInt(g.dataset.id);
                if (shortestPath.slice(0, currentPlayerStep + 1).includes(id)) {
                    circle.classList.add('visited');
                }
                
                const nextNodeId = shortestPath[currentPlayerStep + 1];
                if (id === nextNodeId) {
                    circle.classList.add('option');
                    const newIcon = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    newIcon.setAttribute('x', circle.getAttribute('cx'));
                    newIcon.setAttribute('y', circle.getAttribute('cy'));
                    newIcon.setAttribute('class', 'node-icon');
                    newIcon.textContent = 'ğŸ¦‘';
                    g.appendChild(newIcon);
                }
            });
        }

        function startGame() {
            isPlaying = true;
            shortestPath = dijkstra(nodesData, edgesData, START_NODE, END_NODE);
            currentPlayerStep = 0;
            
            startBtn.style.display = 'none';
            endGameModal.style.display = 'none';
            gameStatus.innerHTML = `<p style="color: var(--squid-green);">éŠæˆ²é€²è¡Œä¸­...</p>`;
            historyLog.innerHTML = '';
            
            updateGraphUI();
            addHistory(`æŒ‘æˆ°é–‹å§‹ï¼è«‹è·Ÿéš¨é­·é­šçš„æŒ‡å¼•ã€‚`, 'info');
        }

        function resetGame() {
            isPlaying = false;
            currentPlayerStep = 0;
            startBtn.style.display = 'block';
            gameStatus.innerHTML = '<p>é»æ“Šã€Œé–‹å§‹æŒ‘æˆ°ã€</p>';
            historyLog.innerHTML = '<p style="color: #666; text-align: center;">é‚„æ²’æœ‰è¨˜éŒ„</p>';
            renderGraph();
        }

        function endGame(isWin) {
            isPlaying = false;

            modalTitle.textContent = isWin ? 'æŒ‘æˆ°æˆåŠŸï¼' : 'æŒ‘æˆ°å¤±æ•—ï¼';
            nextLevelBtn.style.display = isWin ? 'inline-block' : 'none';
            
            endGameModal.style.display = 'flex';
        }
        
        startBtn.addEventListener('click', startGame);
        replayBtn.addEventListener('click', () => {
            endGameModal.style.display = 'none';
            resetGame();
        });
        
        resetGame();
    </script>
</body>
</html>